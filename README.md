# üîÑ AMO CRM ‚Üí Google Sheets Integration

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ –∏–∑ AMO CRM –≤ Google –¢–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ webhook**

[![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)](https://nodejs.org/)
[![Railway](https://img.shields.io/badge/Deploy-Railway-purple.svg)](https://railway.app/)
[![Status](https://img.shields.io/badge/Status-Production%20Ready-brightgreen.svg)]()

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤–µ–±—Ö—É–∫-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –º–µ–∂–¥—É AMO CRM –∏ Google Sheets –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–¥–µ–ª–æ–∫ –∏–∑ –≤–æ—Ä–æ–Ω–∫–∏ **"–ï–í–ì –°–ü–ë"** –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

### ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- üîó **Webhook-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫** –¥–ª—è AMO CRM
- üéØ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ –≤–æ—Ä–æ–Ω–∫–µ "–ï–í–ì –°–ü–ë" 
- üìä **–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** —Å Google Sheets
- üîÑ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤ AMO CRM
- üìù **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- üõ°Ô∏è **Rate limiting** –∏ –∑–∞—â–∏—Ç–∞ API
- ‚ö° **Retry –ª–æ–≥–∏–∫–∞** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- üè• **Health checks** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üöÄ Quick Start

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
npm install
npm start

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã  
curl http://localhost:3000/health

# 3. –ê–≤—Ç–æ—Ç–µ—Å—Ç
./test.sh
```

**Webhook URL**: `https://your-app.railway.app/webhook/amocrm`

üìñ **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**: [QUICK_START.md](QUICK_START.md)

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è:
| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|------|----------|----------|
| ID —Å–¥–µ–ª–∫–∏ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä | AMO CRM |
| –ù–∞–∑–≤–∞–Ω–∏–µ | –ò–º—è —Å–¥–µ–ª–∫–∏ | AMO CRM |
| –ë—é–¥–∂–µ—Ç | –°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö | AMO CRM |
| –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | ISO —Ñ–æ—Ä–º–∞—Ç | AMO CRM |
| –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è | ISO —Ñ–æ—Ä–º–∞—Ç | AMO CRM |
| –≠—Ç–∞–ø | –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏ | AMO CRM |
| –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π | –ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ | AMO CRM |
| –ö–æ–Ω—Ç–∞–∫—Ç | –ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ | AMO CRM |
| –¢–µ–ª–µ—Ñ–æ–Ω | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ | AMO CRM |
| Email | –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ | AMO CRM |
| –ö–æ–º–ø–∞–Ω–∏—è | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ | AMO CRM |
| –°—Ç–∞—Ç—É—Å | –ê–∫—Ç–∏–≤–Ω–∞/–£–¥–∞–ª–µ–Ω–∞ | –°–∏—Å—Ç–µ–º–∞ |
| –ò—Å—Ç–æ—á–Ω–∏–∫ | AMO CRM | –°–∏—Å—Ç–µ–º–∞ |

## üîß API Endpoints

### Webhook
- `POST /webhook/amocrm` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–∞ –æ—Ç AMO CRM

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥  
- `GET /health` - –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `GET /status` - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
- `GET /webhook/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±—Ö—É–∫–∞

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- `POST /sync/deal/:dealId` - –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–¥–µ–ª–∫–∏
- `POST /token/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ AMO CRM

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `GET /test/amocrm` - –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AMO CRM  
- `GET /test/google-sheets` - –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google Sheets

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ logger.js           # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Winston
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ webhookController.js # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ syncController.js    # –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ amoService.js       # AMO CRM API
‚îÇ   ‚îú‚îÄ‚îÄ googleService.js    # Google Sheets API  
‚îÇ   ‚îî‚îÄ‚îÄ tokenService.js     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ rateLimiter.js      # Rate limiting
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ helpers.js          # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ validators.js       # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ server.js               # Express —Å–µ—Ä–≤–µ—Ä
```

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
git clone <repository>
cd amo_evgenich_new
npm install
cp .env.example .env
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env
npm start
```

### Railway –¥–µ–ø–ª–æ–π
–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é! –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

```bash
git push origin main
# Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç
```

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. AMO CRM Webhook
- **URL**: `https://your-app.railway.app/webhook/amocrm`
- **–°–æ–±—ã—Ç–∏—è**: –°–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞, –°–¥–µ–ª–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞
- **–§–∏–ª—å—Ç—Ä**: –í–æ—Ä–æ–Ω–∫–∞ = "–ï–í–ì –°–ü–ë"
- **–ú–µ—Ç–æ–¥**: POST, JSON

### 2. Google Sheets  
- **–¢–∞–±–ª–∏—Ü–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **–ü—Ä–∞–≤–∞**: –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø "–†–µ–¥–∞–∫—Ç–æ—Ä"
- **ID**: `1tD89CZMI8KqaHBx0gmGsHpc9eKYvpuk3OnCOpDYMDdE`

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: [SETUP_GUIDE.md](SETUP_GUIDE.md)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
./test.sh              # –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
./test.sh railway      # –¢–µ—Å—Ç Railway –¥–µ–ø–ª–æ—è
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  
```bash
# –ò–º–∏—Ç–∞—Ü–∏—è webhook
curl -X POST http://localhost:3000/webhook/amocrm \
  -H "Content-Type: application/json" \
  -d @test-webhook-data.json

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–¥–µ–ª–∫–∏
curl -X POST http://localhost:3000/sync/deal/123456
```

üìñ **API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: [API_TESTING.md](API_TESTING.md)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ö–æ–Ω—Å–æ–ª—å**: –í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–§–∞–π–ª—ã**: `logs/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è  
- **Railway**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–æ–≥–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

### –ú–µ—Ç—Ä–∏–∫–∏
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚ùå –û—à–∏–±–∫–∏ –∏ –∏—Ö –ø—Ä–∏—á–∏–Ω—ã  
- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### Health Checks
```bash
curl https://your-app.railway.app/health
curl https://your-app.railway.app/status  
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞
- üõ°Ô∏è **Rate limiting**: 100 req/min –¥–ª—è webhook
- üîê **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- üìù **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è**: –õ–æ–≥–∏ –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤
- üîÑ **Retry**: –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff

### –¢–æ–∫–µ–Ω—ã
- üîÑ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ö–∞–∂–¥—ã–π —á–∞—Å
- üíæ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- üîç **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°—Ç–∞—Ç—É—Å —Ç–æ–∫–µ–Ω–æ–≤ –≤ `/status`

## üöÄ Production Ready

### –ì–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ–∫–µ–Ω—ã** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —á–∞—Å
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - retry —Å backoff
- ‚úÖ **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞  
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
- ‚úÖ **Health checks** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –ø–æ–ª–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–í—Å–µ —Ç–æ–∫–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ Railway:
- `AMO_*` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ AMO CRM
- `GOOGLE_*` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Google Sheets  
- `PORT`, `NODE_ENV` - –°–∏—Å—Ç–µ–º–Ω—ã–µ

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìñ [QUICK_START.md](QUICK_START.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (2 –º–∏–Ω—É—Ç—ã)
- üõ†Ô∏è [SETUP_GUIDE.md](SETUP_GUIDE.md) - –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞  
- üß™ [API_TESTING.md](API_TESTING.md) - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
- üöÄ [DEPLOY_READY.md](DEPLOY_READY.md) - –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. üîÑ **–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –°–¥–µ–ª–∫–∏ –∏–∑ "–ï–í–ì –°–ü–ë" ‚Üí Google Sheets
2. ‚ö° **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è**: –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
3. üîß **–ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å**: –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
4. üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
5. üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä—ã

**Webhook URL –¥–ª—è AMO CRM**: `https://your-app.railway.app/webhook/amocrm`

---

üí° **–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–µ–Ω!**
